import{M as f,a as d,b as o,d as m,fa as u,i as v,j as l,l as g,wb as S}from"./chunk-GY52ECZ2.js";var b=class h{STORAGE_KEY="iisa_candidates";VISITS_KEY="iisa_visits";candidatesList=u([]);visitStats=u({totalVisits:0,registrations:0});dashboardStats=S(()=>{let t=this.candidatesList(),e=this.visitStats();return{totalCandidates:t.length,totalVisits:e.totalVisits,registrationRate:e.totalVisits>0?e.registrations/e.totalVisits*100:0,ageBreakdown:this.calculateAgeBreakdown(t)}});constructor(){this.loadData(),this.trackVisit(),this.setupLiveUpdates()}loadData(){try{let t=localStorage.getItem(this.STORAGE_KEY),a=(t?JSON.parse(t):[]).map(s=>o(d({},s),{submissionDate:new Date(s.submissionDate),lastEditDate:s.lastEditDate?new Date(s.lastEditDate):void 0,canEdit:this.canEditCandidate(new Date(s.submissionDate))}));this.candidatesList.set(a);let i=localStorage.getItem(this.VISITS_KEY);if(i){let s=JSON.parse(i);this.visitStats.set(d({},s))}}catch(t){console.error("Error loading data:",t)}}saveData(){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.candidatesList())),localStorage.setItem(this.VISITS_KEY,JSON.stringify(this.visitStats()))}catch(t){console.error("Error saving data:",t)}}trackVisit(){let t=this.visitStats();this.visitStats.set(o(d({},t),{totalVisits:t.totalVisits+1})),this.saveData()}addCandidate(t){let e=this.generateId(),a;return t.profileImage?a=v(this.fileToBase64(t.profileImage)):a=l(void 0),a.pipe(g(i=>{let s={id:e,fullName:t.fullName,email:t.email,phoneNumber:t.phoneNumber,age:t.age,city:t.city,hobbies:t.hobbies,whyPerfectCandidate:t.whyPerfectCandidate,profileImage:i,submissionDate:new Date,canEdit:!0},p=this.candidatesList();this.candidatesList.set([...p,s]);let n=this.visitStats();return this.visitStats.set(o(d({},n),{registrations:n.registrations+1})),this.saveData(),e}))}updateCandidate(t,e){let a=this.candidatesList(),i=a.findIndex(n=>n.id===t);if(i===-1)return l(!1);let s=a[i];return this.canEditCandidate(s.submissionDate)?(e.profileImage?new m(n=>{let r=new FileReader;r.onload=()=>{n.next(r.result),n.complete()},r.onerror=c=>n.error(c),r.readAsDataURL(e.profileImage)}):l(s.profileImage)).pipe(g(n=>{let r=o(d({},s),{fullName:e.fullName,email:e.email,phoneNumber:e.phoneNumber,age:e.age,city:e.city,hobbies:e.hobbies,whyPerfectCandidate:e.whyPerfectCandidate,profileImage:n,lastEditDate:new Date,canEdit:this.canEditCandidate(s.submissionDate)}),c=[...a];return c[i]=r,this.candidatesList.set(c),this.saveData(),!0})):l(!1)}removeCurrentUserCandidate(t){if(!t)return;let e=this.candidatesList(),a=e.filter(i=>i.id!==t);if(a.length!==e.length){this.candidatesList.set(a);let i=this.visitStats();this.visitStats.set(o(d({},i),{registrations:Math.max(0,i.registrations-1)})),this.saveData()}}getCurrentUserCandidate(t){return t&&this.candidatesList().find(e=>e.id===t)||null}getCandidateById(t){return this.candidatesList().find(e=>e.id===t)}canEditCandidate(t){return Date.now()-t.getTime()<2592e5}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}fileToBase64(t){return new Promise((e,a)=>{let i=new FileReader;i.readAsDataURL(t),i.onload=()=>e(i.result),i.onerror=s=>a(s)})}calculateAgeBreakdown(t){let e={};return this.candidatesList().forEach(a=>{a.age!=null&&(e[a.age]=(e[a.age]||0)+1)}),Object.keys(e).map(a=>({age:+a,count:e[+a]})).sort((a,i)=>a.age-i.age)}setupLiveUpdates(){window.addEventListener("storage",t=>{(t.key===this.STORAGE_KEY||t.key===this.VISITS_KEY)&&this.loadData()})}findCandidateByEmail(t){return this.candidatesList().find(e=>e.email.toLowerCase()===t.toLowerCase())}static \u0275fac=function(e){return new(e||h)};static \u0275prov=f({token:h,factory:h.\u0275fac,providedIn:"root"})};export{b as a};

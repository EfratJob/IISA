import{L as S,a as d,b as o,d as m,ea as g,i as v,j as c,l as h,ub as b}from"./chunk-HMVJ2CLW.js";var f=class u{STORAGE_KEY="iisa_candidates";VISITS_KEY="iisa_visits";CURRENT_USER_KEY="iisa_current_user";candidatesList=g([]);visitStats=g({totalVisits:0,registrations:0});dashboardStats=b(()=>{let t=this.candidatesList(),e=this.visitStats();return{totalCandidates:t.length,totalVisits:e.totalVisits,registrationRate:e.totalVisits>0?e.registrations/e.totalVisits*100:0,ageBreakdown:this.calculateAgeBreakdown(t)}});constructor(){this.loadData(),this.trackVisit(),this.setupLiveUpdates()}loadData(){try{let t=localStorage.getItem(this.STORAGE_KEY),a=(t?JSON.parse(t):[]).map(i=>o(d({},i),{submissionDate:new Date(i.submissionDate),lastEditDate:i.lastEditDate?new Date(i.lastEditDate):void 0,canEdit:this.canEditCandidate(new Date(i.submissionDate))}));this.candidatesList.set(a);let s=localStorage.getItem(this.VISITS_KEY);if(s){let i=JSON.parse(s);this.visitStats.set(d({},i))}}catch(t){console.error("Error loading data:",t)}}saveData(){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.candidatesList())),localStorage.setItem(this.VISITS_KEY,JSON.stringify(this.visitStats()))}catch(t){console.error("Error saving data:",t)}}trackVisit(){let t=this.visitStats();this.visitStats.set(o(d({},t),{totalVisits:t.totalVisits+1})),this.saveData()}addCandidate(t){let e=this.generateId(),a;return t.profileImage?a=v(this.fileToBase64(t.profileImage)):a=c(void 0),a.pipe(h(s=>{let i={id:e,fullName:t.fullName,email:t.email,phoneNumber:t.phoneNumber,age:t.age,city:t.city,hobbies:t.hobbies,whyPerfectCandidate:t.whyPerfectCandidate,profileImage:s,submissionDate:new Date,canEdit:!0},p=this.candidatesList();this.candidatesList.set([...p,i]);let n=this.visitStats();return this.visitStats.set(o(d({},n),{registrations:n.registrations+1})),localStorage.setItem(this.CURRENT_USER_KEY,e),this.saveData(),e}))}updateCandidate(t,e){let a=this.candidatesList(),s=a.findIndex(n=>n.id===t);if(s===-1)return c(!1);let i=a[s];return this.canEditCandidate(i.submissionDate)?(e.profileImage?new m(n=>{let r=new FileReader;r.onload=()=>{n.next(r.result),n.complete()},r.onerror=l=>n.error(l),r.readAsDataURL(e.profileImage)}):c(i.profileImage)).pipe(h(n=>{let r=o(d({},i),{fullName:e.fullName,email:e.email,phoneNumber:e.phoneNumber,age:e.age,city:e.city,hobbies:e.hobbies,whyPerfectCandidate:e.whyPerfectCandidate,profileImage:n,lastEditDate:new Date,canEdit:this.canEditCandidate(i.submissionDate)}),l=[...a];return l[s]=r,this.candidatesList.set(l),this.saveData(),!0})):c(!1)}getCurrentUserCandidate(){let t=localStorage.getItem(this.CURRENT_USER_KEY);return t&&this.candidatesList().find(e=>e.id===t)||null}getCandidateById(t){return this.candidatesList().find(e=>e.id===t)}canEditCandidate(t){return Date.now()-t.getTime()<2592e5}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}fileToBase64(t){return new Promise((e,a)=>{let s=new FileReader;s.readAsDataURL(t),s.onload=()=>e(s.result),s.onerror=i=>a(i)})}calculateAgeBreakdown(t){let e={};return this.candidatesList().forEach(a=>{a.age!=null&&(e[a.age]=(e[a.age]||0)+1)}),Object.keys(e).map(a=>({age:+a,count:e[+a]})).sort((a,s)=>a.age-s.age)}setupLiveUpdates(){setInterval(()=>{this.loadData()},5e3)}static \u0275fac=function(e){return new(e||u)};static \u0275prov=S({token:u,factory:u.\u0275fac,providedIn:"root"})};export{f as a};

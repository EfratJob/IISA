<div class="dashboard-container">
<div class="actions-bar">
  <button mat-stroked-button color="warn" (click)="logout()">
    <mat-icon>logout</mat-icon>
    Logout
  </button>
  <button mat-stroked-button (click)="viewMode.set(viewMode() === 'grid' ? 'list' : 'grid')">
    <mat-icon>{{ viewMode() === 'grid' ? 'view_list' : 'grid_view' }}</mat-icon>
    {{ viewMode() === 'grid' ? 'List view' : 'Grid view' }}
  </button>
</div>

<mat-card class="map-card">
  <mat-card-header>
    <mat-card-title>
      <mat-icon>map</mat-icon>
      Map of registrations
    </mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <div id="map" class="map-container"></div>
  </mat-card-content>
  </mat-card>

    <div class="stats-grid">
        <mat-card class="stat-card">
            <mat-card-content>
                <div class="stat-content">
                    <mat-icon class="stat-icon candidates-icon">people</mat-icon>
                    <div class="stat-info">
                        <h2>{{ dashboardStats().totalCandidates }}</h2>
                        <p>Registered candidates</p>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>

        <mat-card class="stat-card">
            <mat-card-content>
                <div class="stat-content">
                    <mat-icon class="stat-icon visits-icon">visibility</mat-icon>
                    <div class="stat-info">
                        <h2>{{ dashboardStats().totalVisits }}</h2>
                        <p>Total visits</p>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>

        <mat-card class="stat-card">
            <mat-card-content>
                <div class="stat-content">
                    <mat-icon class="stat-icon rate-icon">trending_up</mat-icon>
                    <div class="stat-info">
                        <h2>{{ dashboardStats().registrationRate.toFixed(1) }}%</h2>
                        <p>Registration rate</p>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>

    </div>

    <mat-card class="candidates-card">
        <mat-card-header>
            <mat-card-title>
                <mat-icon>search</mat-icon>
                Searching and filtering candidates </mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <div class="filters-container">

                <mat-form-field appearance="outline" class="search-field">
                    <mat-label>Search</mat-label>
                    <input matInput [ngModel]="searchTerm()" (ngModelChange)="updateSearchTerm($event)"
                        placeholder="Search by name or email..." />
                    <mat-icon matSuffix>search</mat-icon>
                </mat-form-field>

                <mat-form-field appearance="outline" class="filter-field">
                    <mat-label>Filter by city</mat-label>
                    <mat-select [value]="selectedCityFilter()" (selectionChange)="selectedCityFilter.set($event.value)">
                        <mat-option value="">All cities</mat-option>
                        <mat-option *ngFor="let city of availableCities()" [value]="city">
                            {{ city }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                

                <mat-form-field appearance="outline">
                    <mat-label>Minimum age</mat-label>
                    <input matInput type="number" [ngModel]="minAge()" (ngModelChange)="setMinAge($event)">
                </mat-form-field>

                <mat-form-field appearance="outline">
                    <mat-label>Maximum age</mat-label>
                    <input matInput type="number" [ngModel]="maxAge()" (ngModelChange)="setMaxAge($event)">
                </mat-form-field>

            </div>
        </mat-card-content>

    </mat-card>

    <mat-card class="candidates-card">
        <mat-card-header>
            <mat-card-title>
                <mat-icon>people</mat-icon>
                List of candidates ({{ filteredCandidates().length }})
            </mat-card-title>
        </mat-card-header>
        <mat-card-content>
            @if(filteredCandidates().length > 0){
            <div [ngClass]="viewMode() === 'grid' ? 'candidates-grid' : 'candidates-list'">
                @for(candidate of filteredCandidates(); track candidate.id){
                <mat-card class="candidate-card" [class.list-item]="viewMode() === 'list'" [routerLink]="['/candidate', candidate.id]">
                    <div class="candidate-image-container">
                        <img *ngIf="candidate.profileImage" [src]="candidate.profileImage" [alt]="candidate.fullName"
                            class="candidate-image">
                        <mat-icon *ngIf="!candidate.profileImage" class="default-avatar">
                            account_circle
                        </mat-icon>
                    </div>

                    <mat-card-content>
                        <h3>{{ candidate.fullName }}</h3>
                        <p class="candidate-details">
                            <mat-icon>email</mat-icon>
                            {{ candidate.email }}
                        </p>
                        <p class="candidate-details">
                            <mat-icon>location_city</mat-icon>
                            {{ candidate.city }} | Age: {{ candidate.age }}
                        </p>
                        <p class="candidate-summary">
                            {{ getCandidateSummary(candidate.whyPerfectCandidate) }}
                        </p>

                        <div class="candidate-meta">
                            <mat-chip-set>
                                <mat-chip *ngIf="candidate.canEdit" color="accent" selected>
                                    <mat-icon>edit</mat-icon>
                                    Editable
                                </mat-chip>
                                <mat-chip>
                                    <mat-icon>calendar_today</mat-icon>
                                    {{ candidate.submissionDate! | date:'dd/MM/yyyy' }}
                                </mat-chip>
                            </mat-chip-set>
                        </div>
                    </mat-card-content>
                </mat-card>
                }

            </div>
            }
            @else{
            <div class="no-candidates">
                <mat-icon>person_off</mat-icon>
                <p>No candidates were found that fit the criteria</p>
            </div>
            }
        </mat-card-content>
    </mat-card>

    <div class="charts-grid">
        <mat-card class="chart-card">
            <mat-card-header>
                <mat-card-title>
                    <mat-icon>bar_chart</mat-icon>
                    Age distribution </mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <canvas id="ageChart"></canvas>
            </mat-card-content>
        </mat-card>
    </div>
</div>